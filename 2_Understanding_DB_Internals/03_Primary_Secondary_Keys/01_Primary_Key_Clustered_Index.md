# ğŸ”‘ Primary Key - Clustered Index

> Primary Key ela work avutundi? Range queries lo advantage enti?

---

## ğŸ¯ Primary Key Ante Enti?

**Primary Key** = Unique identifier for each row + Usually creates clustering!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   Primary Key = Two things:                             â”‚
â”‚                                                         â”‚
â”‚   1. UNIQUE - duplicate values not allowed              â”‚
â”‚   2. CLUSTERED - data is sorted by this column         â”‚
â”‚      (in most databases)                               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Clustered Index Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   Table with Primary Key on ID:                        â”‚
â”‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              B-TREE INDEX                        â”‚  â”‚
â”‚   â”‚                                                  â”‚  â”‚
â”‚   â”‚                  [50]                            â”‚  â”‚
â”‚   â”‚                 /     \                          â”‚  â”‚
â”‚   â”‚              [25]     [75]                       â”‚  â”‚
â”‚   â”‚             /   \     /   \                      â”‚  â”‚
â”‚   â”‚         [1-24][25-49][50-74][75-100]            â”‚  â”‚
â”‚   â”‚            â†“      â†“      â†“      â†“               â”‚  â”‚
â”‚   â”‚                                                  â”‚  â”‚
â”‚   â”‚   ğŸ‘† DATA is stored IN the index leaves!        â”‚  â”‚
â”‚   â”‚   Not separate heap!                            â”‚  â”‚
â”‚   â”‚                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Range Query Advantage

```sql
SELECT * FROM employees WHERE id BETWEEN 1 AND 10
```

**With Clustered Index (Primary Key):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   Data is SORTED! So IDs 1-10 are TOGETHER!            â”‚
â”‚                                                         â”‚
â”‚   Page 1: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12...]   â”‚
â”‚           â”œâ”€â”€ IDs 1-10 are consecutive! â”€â”€â”¤            â”‚
â”‚                                                         â”‚
â”‚   Read: 1 page = All 10 rows! âš¡                        â”‚
â”‚   IO Count: 1-2 IOs                                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Without Clustering (Heap):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   Data is NOT sorted! IDs are scattered!               â”‚
â”‚                                                         â”‚
â”‚   Page 1: [7, 15, 3, 22, 1]                            â”‚
â”‚   Page 2: [9, 45, 2, 8, 30]                            â”‚
â”‚   Page 3: [5, 6, 10, 4, 99]                            â”‚
â”‚   ...                                                   â”‚
â”‚                                                         â”‚
â”‚   To get IDs 1-10: Must read MANY pages! ğŸ¢             â”‚
â”‚   IO Count: Could be 10+ IOs!                          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š IO Comparison

| Query | Clustered (Primary Key) | Heap |
|-------|------------------------|------|
| `WHERE id BETWEEN 1 AND 10` | 1-2 IOs âš¡ | 10+ IOs ğŸ¢ |
| `WHERE id = 5` | 1-2 IOs âš¡ | 1-2 IOs (with index) |

---

## ğŸ¢ Oracle Term: IOT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   Oracle calls it: IOT = Index Organized Table         â”‚
â”‚                                                         â”‚
â”‚   "I like this name!" - Instructor                     â”‚
â”‚   "It describes EXACTLY what it is!"                   â”‚
â”‚                                                         â”‚
â”‚   IOT = Table that IS the index                        â”‚
â”‚   Data stored inside index structure                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Primary Key Benefits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  âœ… BENEFITS:                                           â”‚
â”‚                                                         â”‚
â”‚  1. Range queries SUPER FAST                           â”‚
â”‚     WHERE id BETWEEN x AND y                           â”‚
â”‚                                                         â”‚
â”‚  2. ORDER BY primary key = FREE                        â”‚
â”‚     Data is already sorted!                            â”‚
â”‚                                                         â”‚
â”‚  3. Get full row in one lookup                         â”‚
â”‚     Data is in the index itself                        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ Primary Key Downsides

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  âš ï¸ DOWNSIDES:                                         â”‚
â”‚                                                         â”‚
â”‚  1. Only ONE clustered index per table                 â”‚
â”‚     - Can't cluster on id AND name                     â”‚
â”‚                                                         â”‚
â”‚  2. Insert can be slow if not sequential               â”‚
â”‚     - Random IDs (like UUID) = bad! ğŸš«                  â”‚
â”‚     - Sequential IDs (1, 2, 3...) = good! âœ…            â”‚
â”‚                                                         â”‚
â”‚  3. Updates to primary key = expensive                 â”‚
â”‚     - Must move row to new position                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ UUID Warning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  âš ï¸ UUID as Primary Key in MySQL:                      â”‚
â”‚                                                         â”‚
â”‚  UUID = Random string like "a1b2c3d4-e5f6-..."         â”‚
â”‚                                                         â”‚
â”‚  Problem:                                              â”‚
â”‚  - UUIDs are RANDOM                                    â”‚
â”‚  - Each insert goes to RANDOM position                 â”‚
â”‚  - Causes PAGE SPLITS (expensive!)                     â”‚
â”‚                                                         â”‚
â”‚  Better options:                                       â”‚
â”‚  - Auto-increment ID (1, 2, 3...)                      â”‚
â”‚  - UUIDv7 (time-based, sequential)                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒŸ Key Points (Remember!)

```
âœ… Primary Key = Unique + Usually Clustered
âœ… Clustered = Data sorted by key
âœ… Range queries benefit MOST from clustering
âœ… Only ONE clustered index per table
âœ… Avoid random UUIDs as primary key in MySQL!
```

---

## â¡ï¸ Next: [Secondary Index Mechanics](./03_Secondary_Index_Mechanics.md)
